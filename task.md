# Тестовое задание: сервис с внешним API и SQLite

## Кратко о проекте

Мини‑сервис на FastAPI, который забирает данные из внешнего API и сохраняет их в SQLite.
В репозитории намеренно допущены ошибки, из‑за которых сервис работает некорректно.
Ваша задача: починить ошибки и затем сделать небольшой рефакторинг в сторону чистой архитектуры.

### Стек

* Python 3.11+
* FastAPI, httpx
* SQLAlchemy 2.0, SQLite
* pytest (минимальные тесты)

### Быстрый старт

```bash
pip install -r requirements.txt
uvicorn main:app --reload

# Запуск тестов
pytest -v
```
**Важно!** В текущей реализации, хоть это и плохо (почему?), но сначала поднимаете сервис, 
только потом запускаете тесты.

Сервис поднимется на `http://localhost:8000`. Внешний фейковый API смонтирован как 
саб‑приложение по `/external`.

### Эндпоинты (основные)

* `POST /sync` — синхронизирует данные из внешнего API в локальную БД. Параметры: `page`, `limit`, `since` (ISO‑дата/время).
* `GET /items` — возвращает список актуальных элементов из БД.

---

## Что нужно исправить и что сделать после

### Ошибки, мешающие корректной работе

1. **Параметры запроса к внешнему API не передаются.**
   В `ExternalClient.get_items` параметры `page`, `limit`, `since` игнорируются, из‑за чего `/sync` всегда тянет дефолтные данные.

2. **Список данных не работает корректно.**
   Эндпоинт `GET /items` возвращает неправильный набор записей (логика фильтрации нарушена).

3. **Старые (удалённые) данные продолжают возвращаться.**
   При синхронизации признак удаления из источника игнорируется, поэтому «удалённые» элементы остаются «активными» в БД.

### Следующий шаг: упорядочить проект под принципы чистой архитектуры

Минимальный, но осмысленный рефакторинг:

* Разделить слои: `api` (веб‑роуты) → `service/usecase` (бизнес‑правила) → `repository` (доступ к БД) → `external` (клиент внешнего API).
* Ввести простые абстракции (интерфейсы) для репозитория и клиента, чтобы сервис можно было тестировать без реальной БД/сети.
* Оставить доменные модели независимыми от инфраструктуры.

### Критерии готовности

* Исправлены все 3 ошибки, ручки работают как заявлено.
* Добавлены/починены базовые тесты, `pytest` зелёный локально.
* Проведён рефакторинг со слоями и упрощёнными абстракциями.
* Оформленное 

### Не обязательно (но приветствуется)

* Транзакции и идемпотентность sync.
* Индексы и ограничения целостности (например, уникальность id).
* Линтеры/форматтер (ruff/black), makefile, pre‑commit.
* Руководство пользователя (README.md)
* Контейнеризация через Docker

### Тайминги
Время выполнения: 6 часов. Дедлайн отправки решения: 15 октября 9:00

### Примечание от автора
Данное тестовое задание максимально приближено к реальным условиям, которые 
ожидают вас на проекте. Вы вольны делать всё, что посчитаете нужным. Я не ожидаю, 
что за 6 часов будет сделано всё, что указано. Более того, в данном сервисе есть 
еще проблемы, которые будет интересно поискать :)

Советую задавать вопросы и, возможно, даже обращаться за помощью (не гарантирую, что 
смогу помочь, но на вопросы гарантированно отвечу как можно скорее), это также 
учитывается. Контакт: https://t.me/parkiev. Вы можете использовать любые инструменты, 
кроме явного читерства (просить другого человека выполнить тестовое). Надеюсь на понимание. 
Также вне зависимости от того, что вы успеете сделать, отправьте ваш результат, чтобы 
получить обратную связь.
